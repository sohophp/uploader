{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./node_modules/@babel/runtime/helpers/classCallCheck.js","webpack:///./node_modules/@babel/runtime/helpers/createClass.js","webpack:///./src/soho-uploader-file-chunk.js","webpack:///./src/soho-uploader-file-normal.js","webpack:///./src/soho-uploader-thumb.js","webpack:///./src/soho-uploader-file.js","webpack:///./src/soho-uploader.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","instance","Constructor","TypeError","_defineProperties","target","props","length","descriptor","configurable","writable","protoProps","staticProps","SohoUploaderFileChunk","UploaderFile","this","jQuery","window","Uploader","chunk_filename","chunk_length","Math","ceil","size","opts","chunkSize","chunk_index","chunk_size","uploadBefore","uploadChunk","_filename","fd","FormData","start","slice","Blob","webkitSlice","mozSlice","end","min","append","_file","uid","url","chunkAction","type","context","timeout","success","uploadSuccess","error","uploadError","complete","uploadComplete","abort","handleAbort","beforeSend","uploadBeforeSend","data","cache","contentType","processData","async","dataType","xhr","ajaxSettings","upload","addEventListener","event","percent","position","loaded","total","lengthComputable","uploadProgress","alert","ajax","console","log","pos","pc","ts","uploadIsCompleted","status","responseText","uploadCanceled","responseJson","canceled","readyState","returnParams","results","id","filename","cancel","qid","SohoUploaderFileNormal","k","form_data","server","$","ev","e","SohoUploaderThumb","file","width","height","thumbType","image","Image","reader","FileReader","img","document","createElement","thumbImgLoadHandler","src","result","readAsDataURL","objImg","w","destWidth","destHeight","a","sourceX","sourceY","sourceWidth","sourceHeight","destX","destY","h","b","canvas","setAttribute","getContext","drawImage","toDataURL","remove","SohoUploaderFile","Helper","chunked","opt","fetch","method","body","JSON","stringify","getFileName","headers","then","response","statusText","index","srcsize","parseFloat","round","pow","floor","apply","allProgress","isAllCompleted","allComplete","threadNumber","nextThread","uploadQueued","isAllSuccess","allSuccess","makeThumb","SohoUploader","assign","selectBtn","uploadBtn","auto","accept","title","extensions","mimeTypes","numThreads","uploadFailed","debug","thumbWidth","thumbHeight","chunkCancelUrl","multiple","files","threads","fileField","v","createFileField","on","preventDefault","choose","createDocumentFragment","appendChild","css","left","currentTarget","addFiles","addFile","push","startThread","completes","isCompleted","progress","getTotal","getPosition","trigger","isSuccess"],"mappings":"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","file":"soho-uploader.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 2);\n","function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nmodule.exports = _classCallCheck;","function _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nmodule.exports = _createClass;","/**\n * 分块上传\n */\nclass SohoUploaderFileChunk {\n\n    constructor(UploaderFile) {\n        this.jQuery = window.jQuery;\n        this.UploaderFile = UploaderFile;\n        this.Uploader = UploaderFile.Uploader;\n        //第一次分片上传会传回一个文件名,\n        this.chunk_filename = \"\";\n        //共分成几块\n        this.chunk_length = Math.ceil(this.UploaderFile.size / this.Uploader.opts.chunkSize);\n        //第几块\n        this.chunk_index = 0;\n\n        //每块多大\n        this.chunk_size = this.Uploader.opts.chunkSize;\n    }\n\n    upload() {\n        if (!this.UploaderFile.uploadBefore()) {\n            return false;\n        }\n        this.uploadChunk();\n    }\n\n    getFileName() {\n        return this._filename;\n    }\n\n    /**\n     * @return {boolean}\n     */\n    uploadChunk() {\n        // console.log(this.UploaderFile)\n        if (!this.UploaderFile.uploadBefore()) {\n            return false;\n        }\n\n        // console.log(this.chunk_index ,  this.UploaderFile)\n        let\n            fd = new FormData(),\n            start = this.chunk_index * this.chunk_size,\n            slice = \"slice\";\n        if (Blob.prototype.webkitSlice) {\n            slice = \"webkitSlice\";\n        } else if (Blob.prototype.mozSlice) {\n            slice = \"mozSlice\";\n        }\n\n        let end = Math.min(this.UploaderFile.size, start + this.chunk_size);\n        // console.log(this.UploaderFile  , start , end);\n\n        fd.append(\"chunk\", this.UploaderFile._file[slice](start, end));\n        fd.append(\"name\", this.UploaderFile.name);\n        fd.append(\"id\", this.UploaderFile.uid);\n        fd.append(\"size\", this.UploaderFile.size);\n        fd.append(\"index\", this.chunk_index);\n        fd.append(\"start\", start);\n        fd.append(\"end\", end);\n        fd.append(\"filename\", this._filename);\n\n        let opts = {\n            url: this.Uploader.opts.chunkAction,\n            type: \"POST\",\n            context: this,\n            timeout: this.Uploader.opts.timeout,\n            success: this.uploadSuccess,\n            error: this.uploadError,\n            complete: this.uploadComplete,\n            abort: this.handleAbort,\n            beforeSend: this.uploadBeforeSend,\n            data: fd,\n            cache: false,\n            contentType: false,//指定为false才能形成正确的Content-Type\n            processData: false,//不要对form进行处理\n            async: true,\n            dataType: this.Uploader.opts.dataType\n        };\n        opts.xhr = () => {\n            let xhr = this.jQuery.ajaxSettings.xhr();\n            if (xhr.upload) {\n                xhr.upload.addEventListener(\"progress\", event => {\n                    let percent = 0;\n                    let position = event.loaded || event.position;\n                    let total = event.total;\n                    if (event.lengthComputable) {\n                        percent = Math.ceil(position / total * 100);\n                    }\n                    this.uploadProgress(event, position, total, percent);\n                }, false);\n            } else {\n                window.alert(\"請升級瀏覽器\");\n            }\n            return xhr;\n        };\n        this.xhr = this.jQuery.ajax(opts);\n    }\n\n    /**\n     *  //上傳進度\n     * @param event\n     * @param position\n     * @param total\n     * @param percent\n     * @constructor\n     */\n    uploadProgress(event, position, total, percent) {\n        console.log(percent);\n        let pos = position + this.chunk_index * this.chunk_size;\n        total = this.UploaderFile.size;\n        let pc = pos ? Math.ceil(pos / total * 100) : 0;\n        this.UploaderFile.uploadProgress(pos, total, pc);\n    }\n\n    /**\n     *  //上傳完成\n     * @param xhr\n     * @param ts\n     * @constructor\n     */\n    uploadComplete(xhr, ts) {\n        this.Uploader.log(\"uploadComplete:\" + this.chunk_index);\n        if (this.uploadIsCompleted()) {\n            this.UploaderFile.uploadComplete(ts);\n        }\n    }\n\n    /**\n     * //上傳失敗\n     * @param xhr\n     * @param status\n     * @param e\n     * @constructor\n     */\n    uploadError(xhr, status) {\n        // this.status  = 3;\n        switch (status) {\n            case \"parsererror\":\n                this.Uploader.log(\"uploadError\");\n                console.error(\"parsererror:\");\n                console.log(xhr.responseText);\n                break;\n            case \"abort\":\n                //console.log('取消觸發的error');\n                break;\n            default:\n                this.Uploader.log(\"uploadError\");\n                console.error(status, xhr.responseText);\n        }\n\n    }\n\n    /**\n     * 取消上傳\n     * @constructor\n     */\n    handleAbort() {\n        this.Uploader.log(\"handleAbort\");\n        this.UploaderFile.uploadCanceled();\n    }\n\n    /**\n     * 上傳成功\n     * @param responseJson\n     * @param status\n     * @param xhr\n     * @return {boolean}\n     * @constructor\n     */\n    uploadSuccess(responseJson, status, xhr) {\n        //console.clear();\n        if (this.UploaderFile.canceled || xhr.readyState !== 4) {\n            console.log(\"success:is canceled\".xhr.readyState);\n            return false;\n        }\n        this.Uploader.log(\"uploadSuccess\");\n        // console.log(responseJson)\n        let returnParams = responseJson.results;\n        if (!returnParams || returnParams.name !== this.UploaderFile.name || returnParams.id !== this.UploaderFile.uid || !returnParams.filename) {\n            console.error(responseJson, returnParams, this.UploaderFile.name, this.UploaderFile.uid);\n            this.UploaderFile.cancel();\n            return false;\n        }\n\n        this._filename = returnParams.filename;\n\n        if (!this.uploadIsCompleted()) {\n            this.chunk_index++;\n            this.uploadChunk();\n        } else {\n            console.log(responseJson);\n            this.UploaderFile.uploadSuccess(responseJson, status, xhr);\n        }\n    }\n\n    uploadBeforeSend() {\n        this.Uploader.log(this.UploaderFile.qid() + \":uploadBeforeSend...\");\n        return true;\n    }\n\n    /**\n     * 分片上傳是否結束\n     * @return {boolean}\n     * @constructor\n     */\n    uploadIsCompleted() {\n        return this.chunk_index + 1 >= this.chunk_length;\n    }\n}\n\nexport default SohoUploaderFileChunk;\n","/**\n * 正常上傳單個文件\n */\nclass SohoUploaderFileNormal {\n\n    constructor(UploaderFile) {\n        this.UploaderFile = UploaderFile;\n        this.Uploader = UploaderFile.Uploader;\n    }\n\n    upload() {\n\n        if (!this.UploaderFile.uploadBefore()) {\n            return false;\n        }\n\n        const form_data = new FormData();\n        const Uploader = this.Uploader;\n\n        for (let k in Uploader.opts.data) {\n            form_data.append(k, Uploader.opts.data[k]);\n        }\n\n        form_data.append(Uploader.opts.name, this.UploaderFile._file);\n\n        let opts = {\n            url: Uploader.opts.server,\n            type: 'POST',\n            context: this,\n            timeout: Uploader.opts.timeout,\n            success: this.uploadSuccess,\n            error: this.uploadError,\n            complete: this.uploadComplete,\n            abort: this.handleAbort,\n            beforeSend: this.uploadBeforeSend,\n            data: form_data,\n            cache: false,\n            contentType: false,//指定为false才能形成正确的Content-Type\n            processData: false,//不要对form进行处理\n            async: true,\n            dataType: Uploader.opts.dataType\n        };\n\n        opts.xhr = () => {\n            let xhr = $.ajaxSettings.xhr();\n            if (xhr.upload) {\n                xhr.upload.addEventListener('progress', ev => {\n                    let percent = 0,\n                        position = ev.loaded || ev.position,\n                        total = ev.total;\n                    if (ev.lengthComputable) {\n                        percent = Math.ceil(position / total * 100);\n                    }\n                    this.uploadProgress(ev, position, total, percent);\n                }, false);\n            } else {\n                window.alert('請升級瀏覽器');\n            }\n            return xhr;\n        };\n\n        this.xhr = $.ajax(opts);\n    }\n\n    /**\n     * 上傳進度\n     * @param event\n     * @param position\n     * @param total\n     * @param percent\n     */\n    uploadProgress(event, position, total, percent) {\n        return this.UploaderFile.uploadProgress(position, total, percent);\n    }\n\n    /**\n     * 上傳完成\n     * @param xhr\n     * @param ts\n     */\n    uploadComplete(xhr, ts) {\n        return this.UploaderFile.uploadComplete(ts);\n    }\n\n    /**\n     * 上傳失敗\n     * @param xhr\n     * @param status\n     * @param e\n     */\n    uploadError(xhr, status, e) {\n        return this.UploaderFile.uploadError(xhr, status, e);\n    }\n\n    //取消上傳\n    handleAbort() {\n        return this.UploaderFile.uploadCanceled();\n    }\n\n    //上傳成功\n    uploadSuccess(responseText, status, xhr) {\n        return this.UploaderFile.uploadSuccess(responseText, status, xhr);\n    }\n\n    uploadBeforeSend(xhr) {\n        return this.UploaderFile.uploadBeforeSend(xhr);\n    }\n\n}\n\nexport default SohoUploaderFileNormal;\n","/**\n * 縮略圖\n */\nclass SohoUploaderThumb {\n\n    static makeThumb(file, width = 100, height = 100, thumbType = 1) {\n        const image = new Image();\n        const reader = new FileReader();\n        reader.addEventListener('load', ev => {\n            const img = document.createElement('img');\n            img.addEventListener('load', (e) => {\n                this.thumbImgLoadHandler(e.target, width, height, thumbType, image);\n            }, false);\n            img.src = 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==';\n            img.src = ev.target.result;\n        }, false);\n        reader.readAsDataURL(file);\n        return image;\n    }\n\n    static thumbImgLoadHandler(image, width, height, thumbType, objImg) {\n\n     \n        let\n            sourceX = 0,\n            sourceY = 0,\n            sourceWidth = image.width,\n            sourceHeight = image.height,\n            destX = 0,\n            destY = 0,\n            destWidth,\n            destHeight;\n\n        if (thumbType === 2) {\n            let th = 'both',\n                tw = 'both',\n                w = width,\n                h = height;\n            if (width === 0 || image.width < width) {\n                w = this.width;\n            }\n            if (height === 0 || image.height < height) {\n                h = this.height;\n            }\n            destWidth = w;\n            destHeight = h;\n            let a = image.width / w,\n                b = image.height / h, c;\n            if (a < b) {\n                sourceX = 0;\n                sourceWidth = image.width;\n                sourceHeight = h * a;\n                c = image.height - sourceHeight;\n                if (th === 'top') {\n                    sourceY = c;\n                } else if (th === 'bottom') {\n                    sourceY = 0;\n                } else { //both\n                    sourceY = c / 2;\n                }\n            } else {\n                sourceY = 0;\n                sourceHeight = image.height;\n                sourceWidth = w * b;\n                c = image.width - sourceWidth;\n                if (tw === 'left') {\n                    sourceX = c;\n                } else if (tw === 'right') {\n                    sourceX = 0;\n                } else { //both\n                    sourceX = c / 2;\n                }\n            }\n            width = w;\n            height = h;\n        } else {  //1  固定大小使用背景\n            if (height && image.height > height) {\n                destHeight = height;\n                destWidth = height * (image.width / image.height);\n            } else {\n                destWidth = image.width;\n                destHeight = image.height;\n            }\n\n            if (width && destWidth > width) {\n                destHeight = width * (destHeight / destWidth);\n                destWidth = width;\n            }\n            destX = (width - destWidth) / 2;\n            destY = (height - destHeight) / 2;\n        }\n        // console.log('thumbType:' + thumbType);\n        // console.log(sourceX, sourceY, sourceWidth, sourceHeight, destX, destY, destWidth, destHeight);\n        const canvas = document.createElement('canvas');\n        canvas.setAttribute('width', width);\n        canvas.setAttribute('height', height);\n        const ctx = canvas.getContext('2d');\n        ctx.drawImage(image, sourceX, sourceY, sourceWidth, sourceHeight, destX, destY, destWidth, destHeight);\n        if (typeof objImg === 'function') {\n            objImg.call(image, canvas.toDataURL(), width, height, image);\n        } else {\n            objImg.src = canvas.toDataURL();\n            image.remove();\n        }\n        canvas.remove();\n    }\n\n}\n\nexport default SohoUploaderThumb;\n","/**\n * 上传的文件封装\n */\nimport SohoUploaderFileChunk from './soho-uploader-file-chunk.js';\nimport SohoUploaderFileNormal from './soho-uploader-file-normal.js';\nimport SohoUploaderThumb from './soho-uploader-thumb.js';\n\nclass SohoUploaderFile {\n\n    constructor(Uploader, file) {\n\n        this.status = 0; // 狀態, 0: 等待上傳,1: 正在上傳,2:上傳完成,3:上傳出錯,4:已取消上傳,5:上傳成功,6:上傳失敗\n        this.position = 0;//已上傳大小\n        this.percent = 0;//已上傳百分比,\n        this.xhr = null;//XMLHttpRequest,\n        this.canceled = false;\n        this.uid = SohoUploaderFile.qid++;\n        this._file = file;\n        this.name = file.name;\n        this.type = file.type;\n        this.size = file.size;\n        this.total = file.size;//總大小\n        this.Uploader = Uploader;\n        this.Helper = null;\n        this.complete = 0;\n\n        //如果设定了分片上传.并且达到分片大小.使用分片上传方式\n        if (Uploader.opts.chunked) {\n            this.Helper = new SohoUploaderFileChunk(this);\n        } else {\n            this.Helper = new SohoUploaderFileNormal(this);\n        }\n\n    }\n\n    qid() {\n        return this.uid;\n    }\n\n    /**\n     * @todo 解決abort問題. 但會影響續傳...\n     * @return {boolean}\n     */\n\n    upload() {\n\n        if (this.canceled) {\n            return false;\n        }\n\n        if (this.status > 0) {\n            console.log('重复上传');\n            return false;\n        }\n\n        this.status = 1;//標記正在上傳\n\n        this.Helper.upload();\n\n    }\n\n    getTotal() {\n        return this.total;\n    }\n\n    getPosition() {\n        return this.position;\n    }\n\n    /**\n     * //是否上傳完成\n     * @return {boolean}\n     */\n    isCompleted() {\n        return this.complete;\n        // return this.status > 1;\n    }\n\n    /**\n     * //是否上傳成功\n     * @return {boolean}\n     */\n    isSuccess() {\n        return this.status === 5;\n    }\n\n    isCanceled() {\n        return this.canceled;\n    }\n\n    cancel() {\n        this.canceled = true;\n        console.log(this.qid() + ':cancel...');\n        if (this.Helper.xhr && this.Helper.xhr.abort) {\n            this.Helper.xhr.abort();\n        }\n        this.status = 4;\n        this.canceled = true;\n\n        if (this.Uploader.opt('chunked')) {\n            let url = this.Uploader.opt(\"chunkCancelUrl\");\n            // url += url.indexOf('?') === -1 ? '?' : '&';\n            // url += `filename=${this.Helper.getFileName()}`;\n            window.fetch(url, {\n                method: 'DELETE',\n                body: JSON.stringify({filename: this.Helper.getFileName()}),\n                headers: {\n                    'Content-Type': 'application/json',\n                    'Accept': 'application/json',\n                    'X-Requested-With': 'Fetcher'\n                },\n            }).then(response => {\n                console.log(response.status, response.statusText);\n            });\n        }\n\n    }\n\n    sizeFormat() {\n        let value = this.size;\n        if (!value) {\n            return '0 Bytes';\n        }\n        let unitArr = ['Bytes', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'];\n        let index = 0;\n        let srcsize = parseFloat(value);\n        let size = Math.round(srcsize / Math.pow(1024, (index = Math.floor(Math.log(srcsize) / Math.log(1024)))) * 100, 2) / 100;\n        return size + unitArr[index];\n    }\n\n\n    /**\n     * 上傳進度\n     * @param position\n     * @param total\n     * @param percent\n     */\n    uploadProgress(position, total, percent) {\n        this.position = position;\n        this.total = total;\n        this.percent = percent;\n        // console.log(position,  total , percent);\n        if (typeof this.Uploader.opts.uploadProgress === 'function') {\n            this.Uploader.opts.uploadProgress.apply(this, [this, position, total, percent]);\n        }\n        this.Uploader.allProgress();\n    }\n\n    /**\n     * 上傳完成\n     * @param ts\n     */\n    uploadComplete(ts) {\n\n        this.complete = 1;\n        // if (this.status !== 5) {\n        //     this.status = 2;\n        // }\n\n        this.Uploader.log('uploadComplete');\n        if (typeof this.Uploader.opts.uploadComplete === 'function') {\n            this.Uploader.opts.uploadComplete.apply(this, [this, ts]);\n        }\n\n        if (this.Uploader.isAllCompleted()) {\n            this.Uploader.allComplete();\n        }\n\n        this.Uploader.threadNumber--;\n        this.Uploader.nextThread();\n\n    }\n\n    /**\n     * 上傳失敗\n     * @param xhr\n     * @param status\n     * @param e\n     */\n    uploadError(xhr, status, e) {\n        this.status = 3;\n        this.Uploader.log('uploadError');\n        this.Uploader.log(status);\n        if (typeof this.Uploader.opts.uploadError === 'function') {\n            this.Uploader.opts.uploadError.apply(this, [this, xhr, status, e]);\n        }\n    }\n\n    /**\n     * 由 chunk 或者 normal 的 handleAbort 執行\n     * 取消上傳\n     */\n    uploadCanceled() {\n        this.Uploader.log('uploadCanceled');\n        this.status = 4;\n        if (typeof this.Uploader.opts.uploadCanceled === 'function') {\n            this.Uploader.opts.uploadCanceled.apply(this, [this]);\n        }\n    }\n\n    /**\n     *  加入上傳隊列時觸發\n     */\n    uploadQueued() {\n        if (typeof this.Uploader.opts.uploadQueued === 'function') {\n            this.Uploader.opts.uploadQueued.apply(this, [this]);\n        }\n    }\n\n    /**\n     *  上傳成功\n     * @param responseJson\n     * @param status\n     * @param xhr\n     */\n    uploadSuccess(responseJson, status, xhr) {\n        this.status = 5;\n        this.Uploader.log('uploadSuccess');\n        if (typeof this.Uploader.opts.uploadSuccess === 'function') {\n            this.Uploader.opts.uploadSuccess.apply(this, [this, responseJson, status, xhr]);\n        }\n        if (this.Uploader.isAllSuccess()) {\n            this.Uploader.allSuccess();\n        }\n    }\n\n    /**\n     * 開始上傳前\n     * @param xhr\n     * @returns {boolean|*}\n     */\n    uploadBeforeSend(xhr) {\n        this.Uploader.log(this.qid() + ':uploadBeforeSend...');\n        if (typeof this.Uploader.opts.uploadBeforeSend === 'function') {\n            return this.Uploader.opts.uploadBeforeSend.apply(this, [this, xhr]);\n        }\n        return true;\n    }\n\n    /**\n     * 上傳前驗證.返回true才上傳.否則不上傳\n     * @return {boolean}\n     */\n    uploadBefore() {\n\n        this.Uploader.log(this.qid() + ':uploadBefore...');\n        if (!(this.status in [0, 1])) {\n            console.log(`status is ${this.status}!`);\n            return false;\n        }\n\n        if (typeof this.Uploader.opts.uploadBefore === 'function') {\n            return this.Uploader.opts.uploadBefore.apply(this, [this]);\n        }\n\n        return true;\n    }\n\n    thumbImage(width = 100, height = 100) {\n        //this.Uploader.opts.thumbWidth, this.Uploader.opts.thumbHeight\n        return SohoUploaderThumb.makeThumb(this._file, width, height);\n    }\n\n}\n\n//唯一ID\nSohoUploaderFile.qid = 0;\n\nexport default SohoUploaderFile;\n","/**\n * 文件(圖片)上傳\n * @requirements jQuery,HTML5(IE9.0+)\n * @version 2016-04\n * @since 2016-06-06 增加require.js\n * @since 2016-06-24 完成分片上传\n * @since 2020-01-30 完成 esm (ES2015 Modules) 放棄 require.js\n * 2020-11-13\n * debug: 修改complete爲單獨屬性值，解決success狀態值被complete修改，不能激活success問題\n */\n\nimport SohoUploaderFile from './soho-uploader-file.js';\n\nclass SohoUploader {\n\n    constructor(opts = {}) {\n\n        const defaults = {\n            name: 'file',// 上傳後PHP得到的$_FILES[名稱]\n            selectBtn: null, // 選擇button\n            uploadBtn: null, // 上傳button\n            auto: true, // 是否選擇後自動上傳\n            server: 'upload.php',\n            accept: {\n                title: 'Images',\n                extensions: 'gif,jpg,jpeg,bmp,png,svg',\n                mimeTypes: 'image/*'\n            },\n            data: {}, // 附加的參數,\n            numThreads: 3, // 最多同時上傳的線程數\n            uploadProgress: null,//上傳進度,回調函數\n            uploadComplete: null,//上傳完成,回調函數\n            uploadFailed: null,//上傳失敗,回調函數\n            uploadError: null,//上傳出錯,回調函數\n            uploadCanceled: null,//取消上傳,回調函數\n            uploadSuccess: null,//上傳成功,回調函數\n            uploadQueued: null,//加入上傳隊列時觸發@addFile\n            uploadBeforeSend: null,//發送上傳請求回調函數\n            debug: 0,//是否開啟調試\n            timeout: 300000,//上傳超時時間1000表示1秒\n            dataType: 'json',\n            thumbWidth: 60,\n            thumbHeight: 60,\n            chunked: 0, // 分塊上傳,\n            chunkSize: 1024 * 1024 * 5,//单位byte,  1024*1024*2 = 2MB ,\n            chunkAction: 'chunkUpload.php',\n            chunkCancelUrl: '',//取消分片上传网址,用于清理临时文件\n            multiple: 1, // 多選上傳,\n            allComplete: null,//全部完成,回調函數\n            allSuccess: null//合部成功,回調函數\n        };\n\n        this.opts = Object.assign({}, defaults, opts);\n\n        this.files = [];// 儲存所有files\n        this.threads = [];//儲存上傳的線程,\n        this.threadNumber = 0;//有幾個正在上傳的線程\n        this.fileField = null;//上传栏位\n        this.create();\n    }\n\n    log(v) {\n        v = `[SohoUploader] ${v}`;\n        if (this.opts.debug) {\n            window.console.log(v);\n        }\n    }\n\n    create() {\n        this.createFileField();\n        if (this.opts.selectBtn && $(this.opts.selectBtn).length) {\n            $(this.opts.selectBtn).on('click', (e) => {\n                e.preventDefault();\n                this.choose();\n            });\n        }\n        if (this.opts.uploadBtn && $(this.opts.uploadBtn).length) {\n            $(this.opts.uploadBtn).on('click', (e) => {\n                e.preventDefault();\n                this.start();\n            });\n        }\n    }\n\n    /**\n     *  創建file element\n     */\n    createFileField() {\n        this.fileField = document.createElement('input');\n        this.fileField.type = 'file';\n        this.fileField.accept = this.opts.accept.mimeTypes;\n        if (this.opts.multiple) {\n            this.fileField.multiple = 'multiple';\n        }\n\n        document.createDocumentFragment().appendChild(this.fileField);\n\n        $(this.fileField)\n            .css({position: 'absolute', left: '-1000px', 'top': '-1000px'})\n            .on('change', e => {\n                const target = e.currentTarget;\n                e.preventDefault();\n                this.log('fileField Changed');\n                this.addFiles(target.files);\n                this.log('auto:' + this.opts.auto);\n                if (this.opts.auto) {\n                    this.start();\n                }\n            });\n        return this;\n    }\n\n    /**\n     * 添加一組file\n     * @param files\n     */\n    addFiles(files) {\n        for (let i = 0; i < files.length; i++) {\n            this.addFile(files[i]);\n        }\n        return this;\n    }\n\n    /**\n     * 添加file\n     * @param file\n     */\n    addFile(file) {\n        let UploaderFile = new SohoUploaderFile(this, file);\n        //this.files.push(UploaderFile); @tudo 備用\n        //push 不能上傳重復的文件\n        this.threads.push(UploaderFile); //目前完成全部上傳後,沒有刪除隊列只是做了標記已上傳.備用其他操作\n\n        UploaderFile.uploadQueued();//加入隊列準備上傳前執行\n    }\n\n    /**\n     * 開始上傳\n     */\n\n    start() {\n        this.startThread();\n    }\n\n    startThread() {\n        this.nextThread();\n    }\n\n    /**\n     *  查找是否有排队進程.如果有並且正在上傳的數量小於numThreads.開始上傳下一個或多個\n     * @return {number}\n     */\n    nextThread() {\n        let completes = 0;\n        if (this.threadNumber >= this.opts.numThreads) {\n            return completes;\n        }\n\n        for (let i = 0; i < this.threads.length; i++) {\n            let UploaderFile = this.threads[i];\n            if (UploaderFile.status === 0) {\n                this.threadNumber++;\n                UploaderFile.upload();\n                if (this.threadNumber >= this.opts.numThreads) {//同時上傳進程數\n                    return 1;\n                }\n            } else if (UploaderFile.isCompleted()) { //不是等待0,也不是正在上傳1,標記一個完成\n                completes++;\n            }\n        }\n\n        if (completes >= this.threads.length) {//全部完成\n            this.allComplete();\n        }\n    }\n\n    /**\n     * 是否全部完成\n     * @return {boolean}\n     */\n    isAllCompleted() {\n        for (let i = 0; i < this.threads.length; i++) {\n            if (!this.threads[i].isCompleted()) {\n                return false;\n            }\n        }\n        return true;\n    }\n\n    /**\n     *  上傳進程全部完成\n     */\n    allComplete() {\n        this.log('allComplete');\n        if (typeof this.opts.allComplete === 'function') {\n            let progress = this.progress();\n            this.opts.allComplete.apply(this, [this, progress]);\n        }\n    }\n\n    /**\n     * 全部進度\n     */\n    progress() {\n        let total = 0,//總大小\n            position = 0,//總進度\n            percent = 0;//百分比\n        for (let i = 0; i < this.threads.length; i++) {\n            let UploaderFile = this.threads[i];\n            if (UploaderFile.status > 0) {\n                total += UploaderFile.getTotal();\n                position += UploaderFile.getPosition();\n            }\n        }\n        if (position && total) {\n            percent = Math.ceil(position / total * 100);\n        }\n        return {total, position, percent};\n    }\n\n    /**\n     * 全部進度\n     */\n    allProgress() {\n        let v = this.progress();\n        if (typeof this.opts.allProgress === 'function') {\n            this.opts.allProgress.apply(this, [this, v.total, v.position, v.percent]);\n        }\n    }\n\n    /**\n     * 觸發選擇圖片\n     * @returns {SohoUploader}\n     */\n    choose() {\n        $(this.fileField).trigger('click');\n        return this;\n    }\n\n    /**\n     * 返回選項\n     * @param key\n     * @returns {*}\n     */\n    opt(key) {\n        return this.opts[key];\n    }\n\n    /**\n     * 是否全部上傳完成\n     */\n\n    isAllSuccess() {\n        for (let i = 0; i < this.threads.length; i++) {\n            if (!this.threads[i].isSuccess()) {\n                return false;\n            }\n        }\n        return true;\n    }\n\n    /**\n     * 全部完成\n     */\n    allSuccess() {\n        if (typeof this.opts.allSuccess === 'function') {\n            this.opts.allSuccess.apply(this, [this]);\n        }\n    }\n\n}\n\nexport default SohoUploader;\n"],"sourceRoot":""}